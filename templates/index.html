<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Segmentation Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        img { max-width: 100%; border: 1px solid #ccc; margin-bottom: 20px; }
        .plot-card { margin-bottom: 30px; }

        /* Professional banner styling */
        .author-banner {
            background-color: #f8f9fa;
            padding: 15px;
            border: 2px solid #0d6efd;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        /* Smooth ticker animation */
        .scrolling-text {
            display: inline-block;
            white-space: nowrap;
            position: relative;
            animation: ticker 18s linear infinite;
            font-weight: 600;
            font-size: 1.1rem;
            color: #212529;
        }

        @keyframes ticker {
            0%   { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Cell highlight styles */
        .highlight-green { background-color: #28a745 !important; color: white !important; } /* Highest Income */
        .highlight-red { background-color: #dc3545 !important; color: white !important; }   /* Lowest Spending */
        .highlight-blue { background-color: #007bff !important; color: white !important; }  /* Highest Spending */

        /* Legend styling */
        .legend-box {
            display: inline-block;
            width: 18px;
            height: 18px;
            margin-right: 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container">
    <!-- ‚úÖ Professional Banner -->
    <div class="author-banner text-center">
        <div class="scrolling-text">
            FINAL PROJECT ‚Äì Customer Segmentation at LG Corporation | By: 
            <span class="text-primary">Osazuwa Stanley Omoregbe</span> | üåç Deployed on 
            <strong>Render</strong> (AWS deployment attempt unsuccessful)
        </div>
    </div>

    <!-- Dashboard Title -->
    <h1 class="mb-4 text-center">üìä Customer Segmentation Dashboard</h1>

    <!-- Cluster Update Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form action="/update" method="post" class="row g-3 align-items-center">
                <div class="col-auto">
                    <label for="clusters" class="col-form-label">Number of Clusters:</label>
                </div>
                <div class="col-auto">
                    <input type="number" id="clusters" name="clusters" value="4" min="2" max="10" class="form-control">
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plots Section -->
    <h2 class="mb-3">Visualizations</h2>
    <div class="row">
        {% for img in images %}
        <div class="col-md-6 plot-card">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ img }}</h5>
                    <img src="{{ url_for('plots', filename=img) }}" alt="{{ img }}" class="img-fluid">
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Cluster Summary -->
    {% if cluster_summary %}
    <h2 class="mt-5">Cluster Summary</h2>
    <div class="card shadow-sm">
        <div class="card-body">
            {{ cluster_summary | safe }}
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    const tables = document.querySelectorAll("table");
                    tables.forEach(table => {
                        table.classList.add("table", "table-striped", "table-bordered", "align-middle", "text-center");

                        let rows = table.querySelectorAll("tbody tr");
                        let maxIncome = -Infinity, minSpending = Infinity, maxSpending = -Infinity;
                        let incomeIndex = -1, spendingIndex = -1;

                        // Find column indexes
                        table.querySelectorAll("thead th").forEach((th, i) => {
                            if (th.innerText.includes("Annual_Income")) incomeIndex = i;
                            if (th.innerText.includes("Spending_Score")) spendingIndex = i;
                        });

                        // Find max/min values
                        rows.forEach(row => {
                            let income = parseInt(row.cells[incomeIndex].innerText.replace(/,/g, ""));
                            let spending = parseInt(row.cells[spendingIndex].innerText.replace(/,/g, ""));
                            if (income > maxIncome) maxIncome = income;
                            if (spending < minSpending) minSpending = spending;
                            if (spending > maxSpending) maxSpending = spending;
                        });

                        // Apply highlights to specific cells
                        rows.forEach(row => {
                            let incomeCell = row.cells[incomeIndex];
                            let spendingCell = row.cells[spendingIndex];
                            let income = parseInt(incomeCell.innerText.replace(/,/g, ""));
                            let spending = parseInt(spendingCell.innerText.replace(/,/g, ""));
                            if (income === maxIncome) incomeCell.classList.add("highlight-green");
                            if (spending === minSpending) spendingCell.classList.add("highlight-red");
                            if (spending === maxSpending) spendingCell.classList.add("highlight-blue");
                        });
                    });
                });
            </script>

            <!-- ‚úÖ Legend -->
            <div class="mt-3">
                <p><span class="legend-box" style="background-color:#28a745;"></span> Highest Annual Income</p>
                <p><span class="legend-box" style="background-color:#dc3545;"></span> Lowest Spending Score</p>
                <p><span class="legend-box" style="background-color:#007bff;"></span> Highest Spending Score</p>
            </div>

            <!-- ‚úÖ Insights Section -->
            <div class="alert alert-info mt-4">
                <h5>üìå Key Insights</h5>
                <p>
                    The cluster with the <strong>highest income</strong> (green) represents LG‚Äôs wealthiest customers, 
                    who are prime candidates for premium product offerings.  
                    The cluster with the <strong>lowest spending score</strong> (red) highlights customers who are 
                    less engaged, suggesting a need for retention strategies.  
                    Meanwhile, the cluster with the <strong>highest spending score</strong> (blue) identifies 
                    LG‚Äôs most valuable and loyal customers, who should be prioritized for loyalty programs 
                    and exclusive promotions.
                </p>
            </div>

            <!-- ‚úÖ Recommendations Section -->
            <div class="alert alert-success mt-3">
                <h5>üí° Strategic Recommendations</h5>
                <ul class="mb-0">
                    <li><strong>Premium Upsell:</strong> Target high-income customers with luxury products, extended warranties, and exclusive bundles.</li>
                    <li><strong>Retention Campaigns:</strong> Re-engage low-spending clusters with personalized offers, discounts, and customer service outreach.</li>
                    <li><strong>Loyalty Programs:</strong> Reward high-spending clusters with VIP memberships, early access to new products, and referral bonuses.</li>
                    <li><strong>Data-Driven Marketing:</strong> Use segmentation insights to tailor campaigns by cluster, improving ROI and customer satisfaction.</li>
                </ul>
            </div>

            <a href="{{ url_for('download_summary') }}" class="btn btn-success mt-3">‚¨áÔ∏è Download Cluster Summary CSV</a>
        </div>
    </div>
    {% endif %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
